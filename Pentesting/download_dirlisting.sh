#!/usr/bin/bash

FILE="${1}"
OUTPUT_FOLDER="${2}"

if [[ ! "${FILE}" ]]; then
	echo "Se debe de introducir un fichero de urls con contenido como argumento"
	exit 1
fi

if [[ -z "${OUTPUT_FOLDER}" ]]; then
	OUTPUT_FOLDER="data"
fi

while read -r line; do
	url=$(echo "${line}" | xargs)
	if [[ -n "${url}" ]]; then
		echo "Testeando ${url} en busca de Directory Listing..."
		if curl -L -s "${url}" | grep -q -e "Index of /" -e "[PARENTDIR]"; then
			echo -e "\t -!- Encontrado Directory Listing en ${url}"
			echo -e "\t -!- Empezando la descarga recursiva al directorio \"${OUTPUT_FOLDER}\" ..."
			mkdir -p "${OUTPUT_FOLDER}"
			wget -q -r -np -R "index.html*" "${url}" -P "${OUTPUT_FOLDER}"
		fi
	fi
done < <(cat "${FILE}")
