#!/usr/bin/bash

HOSTS="$*"

if [[ "${EUID}" -ne 0 ]]; then
	echo "El escaneo de deteccion de sistema operativo de nmap (-O) requiere de privilegios de root"
	exit 1
fi

if [[ "$#" -eq 0 ]]; then
	echo "Es necesario pasar una IP o un rango"
	exit 1
fi

echo "Ejecutando escaneo de Sistema Operativo en ${HOSTS}..."

nmap_scan=$(nmap -O "${HOSTS}" -oG -)
while read -r line; do
	ip=$(echo "${line}" | awk '{print $2}')
	os=$(echo "${line}" | grep OS | awk -F'OS: ' '{print $2}' | sed 's/Seq.*//g')

	if [[ -n "${ip}" ]] && [[ -n "${os}" ]]; then
		echo "IP: ${ip} OS: ${os}"
	fi
done <<< "${nmap_scan}"
